<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <title>Guida — Tetris — pezzaliAPP</title>
  <meta name="theme-color" content="#0b5fff">
  <style>
    :root{--c1:#0f1320;--c2:#151b31;--c3:#0b5fff;--txt:#e9eef5}
    *{box-sizing:border-box} html,body{margin:0;height:100%}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;background:var(--c1);color:var(--txt)}
    header{position:sticky;top:0;background:var(--c3);color:#fff;padding:12px 16px;box-shadow:0 2px 12px rgba(0,0,0,.25)}
    main{max-width:900px;margin:0 auto;padding:16px;display:grid;gap:16px}
    .card{background:var(--c2);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px}
    h1{font-size:1.2rem;margin:.2rem 0}
    h2{font-size:1.05rem;margin:.2rem 0 .6rem}
    code,kbd{background:rgba(255,255,255,.08);padding:2px 6px;border-radius:6px}
    .grid{display:grid;grid-template-columns:1fr 340px;gap:16px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    canvas{background:#12182a;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.35);width:100%;height:auto}
    .muted{opacity:.9}
    .footer{opacity:.7;font-size:.9rem}
    a{color:#aacbff}
  </style>
</head>
<body>
  <header>
    <h1>Guida — Tetris — pezzaliAPP</h1>
  </header>
  <main>
    <section class="grid">
      <div class="card">
        <h2>Come si gioca</h2>
        <ul>
          <li><kbd>◀︎/▶︎</kbd> Muovi • <kbd>▼</kbd> Soft drop • <kbd>Space</kbd> Hard drop</li>
          <li><kbd>Z/X</kbd> Ruota • <kbd>C</kbd> Hold • <kbd>P</kbd> Pausa • <kbd>R</kbd> Restart</li>
        </ul>
        <p class="muted">Funziona offline, è installabile come app su iPhone/iPad/Android/PC/Mac.</p>
      </div>
      <div class="card">
        <h2>Demo</h2>
        <canvas id="demo" width="240" height="240" aria-label="Demo animata Tetris"></canvas>
        <p class="muted">Mini‑demo in Canvas: tetromino rotante con anteprima blocchi.</p>
      </div>
    </section>

    <section class="card">
      <h2>Installazione su iPhone</h2>
      <ol>
        <li>Apri la pagina con Safari.</li>
        <li>Tocca <strong>Condividi</strong> → <strong>Aggiungi a Home</strong>.</li>
        <li>Avvia l’app dalla Home per schermo intero.</li>
      </ol>
      <p class="muted">Se aggiorni l’app, chiudi e riapri con connessione oppure incrementa la costante <code>CACHE</code> nel <code>service-worker.js</code>.</p>
    </section>

    <section class="card">
      <h2>Licenza</h2>
      <p>MIT — © 2025 pezzaliAPP</p>
    </section>

    <p class="footer">Parte della collezione giochi pezzaliAPP.</p>
  </main>

  <script>
  // Demo Tetris corretta: rotazione attorno al pivot e caduta verticale
  const c = document.getElementById('demo');
  const ctx = c.getContext('2d');

  const GRID = 24;                        // dimensione cella
  const W = c.width, H = c.height;
  const color = '#845ef7';

  // Tetromino T in griglia 4x4 con pivot SRS a (1,1)
  // celle: (x,y) con 0<=x,y<=3
  const cells = [ {x:1,y:0}, {x:0,y:1}, {x:1,y:1}, {x:2,y:1} ];
  const pivot = { x:1, y:1 };             // pivot del pezzo T

  // Stato animazione
  let angle = 0;                          // rotazione continua (solo per effetto demo)
  let yOffset = -2 * GRID;                // parte dall'alto
  const fallSpeed = 0.8;                  // px per frame ~ morbido

  function drawGrid(){
    ctx.fillStyle = '#0e1429';
    ctx.fillRect(0,0,W,H);
    ctx.strokeStyle = 'rgba(255,255,255,.06)';
    for(let x=0;x<=W;x+=GRID){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke(); }
    for(let y=0;y<=H;y+=GRID){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W,y); ctx.stroke(); }
  }

  function drawPiece(){
    // Centro orizzontale
    const originX = Math.floor(W/2);
    const originY = yOffset;

    // Disegna ogni cella ruotando attorno al pivot (in coordinate di cella)
    for(const {x,y} of cells){
      // Trasla rispetto al pivot
      const rx = x - pivot.x;
      const ry = y - pivot.y;

      // Rotazione continua (solo demo): matrice standard
      const cos = Math.cos(angle), sin = Math.sin(angle);
      const ux = rx * cos - ry * sin;
      const uy = rx * sin + ry * cos;

      // Torna in coordinate "pixel" centrando la 4x4 orizzontalmente
      const px = originX + ux * GRID;
      const py = originY + uy * GRID;

      // Disegno blocco
      ctx.fillStyle = color;
      ctx.fillRect(px - GRID/2 + 2, py - GRID/2 + 2, GRID - 4, GRID - 4);

      // riflesso
      ctx.globalAlpha = .2; ctx.fillStyle = '#fff';
      ctx.fillRect(px - GRID/2 + 2, py - GRID/2 + 2, GRID - 4, 5);
      ctx.globalAlpha = 1;
    }
  }

  function loop(){
    drawGrid();
    drawPiece();

    // Aggiorna animazione
    angle += 0.03;             // rotazione fluida (effetto vetrina)
    yOffset += fallSpeed;      // caduta
    const bottom = H - 2*GRID; // "pavimento" visivo
    if (yOffset > bottom){
      yOffset = -2 * GRID;     // reset dall'alto
    }

    requestAnimationFrame(loop);
  }
  loop();
</script>
</body>
</html>
